<apex:page controller="TracHier.HierarchySetupCtlr" title="{!$Label.trachier__setup_page_title}" id="page" docType="html-5.0"
           tabStyle="Traction_Hierarchies_Setup__tab">
    <apex:stylesheet value="{!URLFOR($Resource.TracHier__AccountHierarchy, 'css/setup.css')}"/>
    <script type="text/javascript" src="{!URLFOR($Resource.AccountHierarchy, 'js/lib/jquery-3.5.0.min.js')}"></script>

    <apex:form id="form">
        <script type="text/javascript">
            "use strict";

            $('.addModalBackground').mousedown(function (e) {
                if ($(e.target).is('.addModal') || $(e.target).parents().is('.addModal')) {
                    return; // don't close when clicking on dialog itself
                }
                cancelAdd();
            });

            function confirmRemove() {
                var result = window.confirm('{!$Label.trachier__setup_confirm_remove_profile_settings}');

                if (result) {
                    callAction('remove');
                }
            }

            var findModalTriesCount = 0;

            function buttonModalAction(selectorId) {
                if (document.getElementById(selectorId) === null) {
                    if (findModalTriesCount < 5) {
                        findModalTriesCount ++;
                        setTimeout(function(){ buttonModalAction(selectorId); }, 1000);
                    }
                    else {
                        findModalTriesCount = 0;
                    }
                } else {
                    findModalTriesCount = 0;
                    scrollToModal(selectorId);
                }
            }

            function scrollToModal(selectorId) {
                var modalElement = document.getElementById(selectorId);
                if (modalElement !== undefined && modalElement !== null ) {
                    modalElement.scrollIntoView();
                }
            }

            function onActionComplete(modalId) {
                buttonModalAction(modalId);
                hideSpinner()
            }

            function showSpinner() {$('#spinner').show();}
            function hideSpinner() {$('#spinner').hide();}

            function callAction(actionFunctionName) {
                if (window.hasOwnProperty(actionFunctionName)) {

                    showSpinner();
                    window[actionFunctionName]();

                }
            }
        </script>

        <apex:actionPoller action="{!updateBatchInProgress}" reRender="builderSettings, buttons" interval="5"
                           enabled="{!batchInProgress}" id="poller"/>

        <apex:actionPoller action="{!updateRollupInProgress}" reRender="builderSettings, rollupSettings, buttons" interval="5"
                           enabled="{!rollupInProgress}" id="rollupPoller"/>

        <!--Action Functions to render specific areas-->
        <apex:actionFunction name="refreshMessages" reRender="messages" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshFilters" reRender="hierarchyFilters" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshChildFilters" reRender="childFilters" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshModalFilters" reRender="hierarchyFiltersModal" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshModalChildFilters" reRender="childFiltersModal" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshHierarchiesSettings" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshWhitespaceSettings" reRender="hierarchysettings" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshWhitespaceSettingsAdd" reRender="hierarchysettings_add" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshAppendBehavior" reRender="form"/>
        <apex:actionFunction name="disableDuplicateCheckChanged" reRender="form" onComplete="hideSpinner()"/>

        <!-- Action Functions for Setting and Updating Field Labels -->
        <apex:actionFunction name="setHierarchyOptions" action="{!settingsMgr.setHierarchyOptions}" reRender="form"/>
        <apex:actionFunction name="refreshFieldLabels" action="{!settingsMgr.refreshFieldLabels}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshChildFieldLabels" action="{!settingsMgr.refreshChildFieldLabels}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshNewFieldLabels" action="{!settingsMgr.refreshNewFieldLabels}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="refreshNewChildFieldLabels" action="{!settingsMgr.refreshNewChildFieldLabels}" reRender="form" onComplete="hideSpinner()"/>

        <!--Profile Settings Action Functions-->
        <apex:actionFunction name="saveAllSettings" action="{!saveAllSettings}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="addNewProfile" action="{!addNewProfile}" reRender="form" onComplete="onActionComplete('page:form:addBlock');"/>
        <apex:actionFunction name="settingsChanged" action="{!selectedSettingsChanged}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="cancelAdd" action="{!settingsMgr.cancel}" reRender="form"/>
        <apex:actionFunction name="remove" action="{!removeProfile}" reRender="form" onComplete="hideSpinner()"/>

        <!-- Child Object Action Functions -->
        <apex:actionFunction name="startAddChildObject" action="{!startAddChildObject}" reRender="form" onComplete="onActionComplete('page:form:addChildObjectBlock')"/>
        <apex:actionFunction name="modalChildObjectChanged" action="{!modalChildObjectChanged}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="savedChildObjectChanged" action="{!childObjectChanged}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="removeChildObject" action="{!removeSavedChildObject}" reRender="form" onComplete="hideSpinner()"/>

        <!-- Hierarchy Action Functions -->
        <apex:actionFunction name="savedHierarchyChanged" action="{!hierarchyChanged}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="removeHierarchy" action="{!removeSavedHierarchy}" reRender="form" onComplete="hideSpinner()"/>

        <!-- Hierarchy Rollup Functions -->
        <apex:actionFunction name="startRollup" action="{!startRollup}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="cancelRollup" action="{!cancelRollup}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="scheduleRollups" action="{!scheduleRollups}" reRender="form" onComplete="hideSpinner()"/>
        <apex:actionFunction name="deleteKPIs" action="{!deleteKPIs}" reRender="form" onComplete="hideSpinner()"/>


        <apex:variable var="displayFieldMetadata" value="{!$ObjectType.TracHier__Hierarchy_Display_Fields__c.fields}"/>
        <apex:variable var="objFiltersMetadata" value="{!$ObjectType.TracHier__Filter__c.fields}"/>

        <apex:variable var="showOverrideFields"
                       value="{!(!hasDnB || theLinkerSettings.TracHier__Override_DnB_Data_Fields__c || !ISBLANK($CurrentPage.parameters.override))}"
                       id="showOverrideFields"/>
        <apex:variable var="showAdvancedWhitespace"
                       value="{! !ISBLANK($CurrentPage.parameters.override)}"
                       id="showAdvancedWhitespace"/>
        <apex:variable var="overrideUnchecked" value="{!NOT(theLinkerSettings.TracHier__Override_DnB_Data_Fields__c)}"
                       id="overrideUnchecked"/>

        <apex:pageMessages id="messages" escape="false" rendered="{!NOT(settingsMgr.addHierarchyInProgress)}"/>

        <div id="spinner" style="display: none;">
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 9998; background-color: black;">
                &nbsp;
            </div>
            <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 9999; margin: 30% 50%">
                <div style="display: inline-block; padding: 2px; background-color: #fff; width: 125px;">
                    <img src="/img/loading.gif" style="float: left; margin: 8px;"/>
                    <span style="display: inline-block; padding: 10px 0px;">Please Wait...</span>
                </div>
            </div>
        </div>

        <apex:pageBlock title="{!$Label.trachier__setup_page_block_title}"
                        helpUrl="https://tractioncomplete.com/platform/automate-account-hierarchy/"
                        helpTitle="{!$Label.trachier__setup_page_block_help_title}" id="block">

            <!--Save Settings, Build Hierarchy Buttons-->
            <apex:pageBlockButtons location="top">
                <apex:commandButton onclick="callAction('saveAllSettings'); return false;" value="{!$Label.trachier__setup_save_button}"
                                    reRender="messages, buttons, advancedSettings"
                                    oncomplete="hideSpinner(); if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"/>
                <apex:outputPanel layout="none" id="buttons">
                    <apex:commandButton value="{!$Label.trachier__setup_start_batch_button}" action="{!configureBatch}"
                                        reRender="form"
                                        rendered="{!NOT(batchInProgress)}"
                                        disabled="{!OR(rollupInProgress, ISBLANK(theLinkerSettings.TracHier__DefaultHierarchy__c))}"
                                        title="{!$Label.trachier__setup_start_batch_button_title}"
                                        oncomplete="onActionComplete('page:form:buildHierarchyModal');"
                    />

                    <apex:commandButton value="{!$Label.trachier__setup_stop_batch_button}" action="{!cancelBatch}"
                                        reRender="messages, builderSettings, buttons, poller"
                                        rendered="{!batchInProgress}"
                                        title="{!$Label.trachier__setup_stop_batch_button_title}"/>

                </apex:outputPanel>
            </apex:pageBlockButtons>

            <!--Add profile settings, remove buttons-->
            <apex:outputPanel >
                <apex:commandButton value="{!$Label.trachier__setup_add_profile_settings_button}"
                                    onclick="callAction('addNewProfile'); return false;" reRender="form"/>
                <apex:selectList size="1" disabled="{!settingsMgr.noSettings}"
                                 value="{!settingsMgr.selectedSettingsName}" onchange="callAction('settingsChanged')">
                    <apex:selectOptions value="{!settingsMgr.settingsPicklist}"/>
                </apex:selectList>
                <apex:commandButton value="{!$Label.trachier__setup_remove_button}"
                                    disabled="{!settingsMgr.defaultSettingsSelected}"
                                    onclick="confirmRemove(); return false;"/>
            </apex:outputPanel>

            <!--Display Fields Section-->
            <apex:pageBlockSection collapsible="false" id="displayfields"
                                   title="{!$Label.trachier__setup_display_fields_section}"
                                   columns="3">

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field1_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Field1__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field1__c}" id="Field1__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field1_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="InputField1__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field1__c}" id="InputField1__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field1_Label__c"/>
                    <apex:inputText id="Field1_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field1_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field1_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field1_Custom__c"/>
                    <apex:inputField id="Field1_Custom__c"
                                     value="{!settingsMgr.currentSettings.fields.TracHier__Field1_Custom__c}"
                                     onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field2_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Field2__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field2__c}" id="Field2__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field2_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="InputField2__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field2__c}" id="InputField2__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field2_Label__c"/>
                    <apex:inputText id="Field2_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field2_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field2_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field2_Custom__c"/>
                    <apex:inputCheckbox id="Field2_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field2_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field3_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Field3__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field3__c}" id="Field3__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field3_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="InputField3__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field3__c}" id="InputField3__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field3_Label__c"/>
                    <apex:inputText id="Field3_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field3_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field3_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field3_Custom__c"/>
                    <apex:inputCheckbox id="Field3_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field3_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field4_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Field4__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field4__c}" id="Field4__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field4_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="InputField4__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field4__c}" id="InputField4__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field4_Label__c"/>
                    <apex:inputText id="Field4_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field4_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field4_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field4_Custom__c"/>
                    <apex:inputCheckbox id="Field4_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field4_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field5_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Field5__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field5__c}" id="Field5__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field5_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="InputField5__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field5__c}" id="InputField5__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field5_Label__c"/>
                    <apex:inputText id="Field5_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field5_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field5_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field5_Custom__c"/>
                    <apex:inputCheckbox id="Field5_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field5_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field6_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Field6__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field6__c}" id="Field6__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.fields.TracHier__Field6_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="InputField6__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field6__c}" id="InputField6__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="Field6_Label__c"/>
                    <apex:inputText id="Field6_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field6_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field6_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="Field6_Custom__c"/>
                    <apex:inputCheckbox id="Field6_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field6_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 7, NOT(settingsMgr.currentSettings.fields.TracHier__Field7_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Field7__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field7__c}" id="Field7__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 7, settingsMgr.currentSettings.fields.TracHier__Field7_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="InputField7__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field7__c}" id="InputField7__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 7}">
                    <apex:outputLabel value="Label" for="Field7_Label__c"/>
                    <apex:inputText id="Field7_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field7_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field7_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 7}">
                    <apex:outputLabel value="Custom" for="Field7_Custom__c"/>
                    <apex:inputCheckbox id="Field7_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field7_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 8, NOT(settingsMgr.currentSettings.fields.TracHier__Field8_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Field8__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field8__c}" id="Field8__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 8, settingsMgr.currentSettings.fields.TracHier__Field8_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="InputField8__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field8__c}" id="InputField8__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 8}">
                    <apex:outputLabel value="Label" for="Field8_Label__c"/>
                    <apex:inputText id="Field8_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field8_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field8_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 8}">
                    <apex:outputLabel value="Custom" for="Field8_Custom__c"/>
                    <apex:inputCheckbox id="Field8_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field8_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 9, NOT(settingsMgr.currentSettings.fields.TracHier__Field9_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Field9__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field9__c}" id="Field9__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 9, settingsMgr.currentSettings.fields.TracHier__Field9_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="InputField9__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field9__c}" id="InputField9__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 9}">
                    <apex:outputLabel value="Label" for="Field9_Label__c"/>
                    <apex:inputText id="Field9_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field9_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field9_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 9}">
                    <apex:outputLabel value="Custom" for="Field9_Custom__c"/>
                    <apex:inputCheckbox id="Field9_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field9_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 10, NOT(settingsMgr.currentSettings.fields.TracHier__Field10_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="Field10__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field10__c}" id="Field10__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 10, settingsMgr.currentSettings.fields.TracHier__Field10_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="InputField10__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field10__c}" id="InputField10__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 10}">
                    <apex:outputLabel value="Label" for="Field10_Label__c"/>
                    <apex:inputText id="Field10_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field10_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field10_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 10}">
                    <apex:outputLabel value="Custom" for="Field10_Custom__c"/>
                    <apex:inputCheckbox id="Field10_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field10_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 11, NOT(settingsMgr.currentSettings.fields.TracHier__Field11_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="Field11__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field11__c}" id="Field11__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 11, settingsMgr.currentSettings.fields.TracHier__Field11_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="InputField11__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field11__c}" id="InputField11__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 11}">
                    <apex:outputLabel value="Label" for="Field11_Label__c"/>
                    <apex:inputText id="Field11_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field11_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field11_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 11}">
                    <apex:outputLabel value="Custom" for="Field11_Custom__c"/>
                    <apex:inputCheckbox id="Field11_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field11_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 12, NOT(settingsMgr.currentSettings.fields.TracHier__Field12_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="Field12__c"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.fields.TracHier__Field12__c}" id="Field12__c" size="1" onChange="callAction('refreshFieldLabels')">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.currentSettings.displayFieldCount >= 12, settingsMgr.currentSettings.fields.TracHier__Field12_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="InputField12__c"/>
                    <apex:inputField value="{!settingsMgr.currentSettings.fields.TracHier__Field12__c}" id="InputField12__c"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 12}">
                    <apex:outputLabel value="Label" for="Field12_Label__c"/>
                    <apex:inputText id="Field12_Label__c" value="{!settingsMgr.currentSettings.fields.TracHier__Field12_Label__c}"
                                    disabled="{!NOT(settingsMgr.currentSettings.fields.TracHier__Field12_Custom__c)}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.displayFieldCount >= 12}">
                    <apex:outputLabel value="Custom" for="Field12_Custom__c"/>
                    <apex:inputCheckbox id="Field12_Custom__c"
                                        value="{!settingsMgr.currentSettings.fields.TracHier__Field12_Custom__c}"
                                        onChange="callAction('refreshFieldLabels')"/>
                </apex:pageBlockSectionItem>


                <apex:commandButton value="Add" action="{!settingsMgr.currentSettings.addDisplayField}"
                                    reRender="displayfields"
                                    disabled="{!settingsMgr.currentSettings.displayFieldCount >= 12}"/>
            </apex:pageBlockSection>

            <!--Display Settings Section-->
            <apex:pageBlockSection collapsible="false" id="hierarchysettings"
                                   title="{!$Label.trachier__setup_display_settings_section}">

                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Show_Records_for_All_Users__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Disable_Per_User_Field_Selection__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Show_Display_Fields_for_All_Users__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Disable_Duplicate_Check__c}"
                                 onchange="callAction('disableDuplicateCheckChanged')"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Create_Inferred_Account_Button__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Click_to_Merge__c}"
                                 rendered="{!NOT(settingsMgr.currentSettings.settings.TracHier__Disable_Duplicate_Check__c)}"/>

                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_CSV_Download__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Inline_Editing__c}"/>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.settings.TracHier__Disable_Duplicate_Check__c}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__Enable_Click_to_Merge__c.label}"
                                      style="color: #909090"/>
                    <apex:inputCheckbox disabled="true"/>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Show_Summary_Footer__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__DefaultDisplayHierarchy__c.Label}"
                            for="defaultDisplayHierarchy"/>
                    <apex:selectList value="{!settingsMgr.currentSettings.settings.TracHier__DefaultDisplayHierarchy__c}"
                                     id="defaultDisplayHierarchy" size="1">
                        <apex:selectOptions value="{!settingsMgr.hierarchyOptions}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>


                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Field_Filters__c}"/>
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Display_Child_Objects__c}"/>

                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Whitespace_Prospecting__c}"
                                 rendered="{!hasDnBSearch}"
                                 onChange="callAction('refreshWhitespaceSettings')" />
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Enable_Mass_Create_Accounts__c}"
                                rendered="{!hasDnBSearch}" />
                <apex:inputField value="{!settingsMgr.currentSettings.settings.TracHier__Show_Overridden_Accounts_in_Whitespace__c}"
                                 rendered="{!AND(hasDnBSearch, settingsMgr.currentSettings.settings.TracHier__Enable_Whitespace_Prospecting__c)}" />
                <apex:pageBlockSectionItem rendered="{!AND(hasDnBSearch, NOT(settingsMgr.currentSettings.settings.TracHier__Enable_Whitespace_Prospecting__c))}" />


            </apex:pageBlockSection>

            <!--Hierarchy Filters Section-->
            <apex:pageBlockSection collapsible="false" id="hierarchyFilters" columns="1"
                                   title="{!$Label.trachier__setup_filters_section}">

                <apex:variable var="rowNum" value="{!0}"/>
                <apex:pageBlockTable value="{!settingsMgr.currentSettings.filters}" var="filter">
                    <apex:column headerValue="#">{!rowNum+1}</apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Field__c.label}">
                        <apex:inputField value="{!filter.obj.TracHier__Field__c}" rendered="{!filter.obj.TracHier__Custom__c}">
                            <apex:actionSupport event="onblur" action="{!filter.updateFilterOpts}"
                                                reRender="hierarchyFilters"/>
                        </apex:inputField>
                        <apex:selectList value="{!filter.obj.TracHier__Field__c}" size="1"
                                         rendered="{!NOT(filter.obj.TracHier__Custom__c)}">
                            <apex:selectOptions value="{!accountFields}"/>
                            <apex:selectOptions value="{!accountFields2}"/>
                            <apex:selectOptions value="{!accountFields3}"/>
                            <apex:actionSupport event="onchange" action="{!filter.updateFilterOpts}"
                                                reRender="hierarchyFilters"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Operator__c.label}">
                        <apex:selectList value="{!filter.obj.TracHier__Operator__c}" size="1">
                            <apex:selectOptions value="{!filter.filterOpts}"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Value__c.label}">
                        <apex:inputField value="{!filter.obj.TracHier__Value__c}"
                                         rendered="{!OR(NOT(filter.isDate),filter.obj.TracHier__Custom__c)}"/>
                        <apex:selectList value="{!filter.obj.TracHier__Value__c}" size="1"
                                         rendered="{!AND(filter.isDate, NOT(filter.obj.TracHier__Custom__c))}">
                            <apex:selectOptions value="{!settingsMgr.dateOpts}"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Custom__c.label}">
                        <apex:inputField onChange="callAction('refreshFilters')" value="{!filter.obj.TracHier__Custom__c}"/>
                    </apex:column>
                    <apex:column >
                        <apex:commandLink action="{!removeFilter}" onclick="this.onclick=function(){return false;}"
                                          reRender="hierarchyFilters">
                            Remove
                            <apex:param name="objFilterIndex" value="{!rowNum}"/>
                        </apex:commandLink>
                        <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                    </apex:column>
                </apex:pageBlockTable>
                <apex:commandButton value="Add" action="{!addFilter}" reRender="hierarchyFilters"/>

                <apex:outputPanel >
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Criteria_Logic__c.Label + '  '}"
                                      for="Criteria_Logic__c"
                                      styleClass="labelCol vfLabelColTextWrap"
                                      style="text-align: left;"/>
                    <apex:inputText value="{!settingsMgr.currentSettings.fields.TracHier__Criteria_Logic__c}"
                                    id="Criteria_Logic__c"
                                    disabled="{!AND(ISBLANK(settingsMgr.currentSettings.fields.TracHier__Criteria_Logic__c),filterCount<2)}"/>
                </apex:outputPanel>
            </apex:pageBlockSection>

            <!--Child Objects Section-->
            <apex:pageBlockSection collapsible="false" id="childObjects" columns="3"
                                   title="{!$Label.trachier__child_object_field_section}">

                <!--Child object buttons-->
                <apex:outputPanel >
                    <apex:commandButton value="{!$Label.trachier__add_child_object_button_label}"
                                        onclick="callAction('startAddChildObject'); return false;" reRender="form"
                                        oncomplete="hideSpinner()"/>
                    <apex:selectList size="1" value="{!settingsMgr.currentSettings.selectedChildObject}"
                                     onchange="callAction('savedChildObjectChanged')">
                        <apex:selectOptions value="{!settingsMgr.currentSettings.childObjectOptions}"/>
                    </apex:selectList>
                    <apex:commandButton value="{!$Label.trachier__setup_remove_button}"
                                        onclick="callAction('removeChildObject'); return false;"
                                        oncomplete="if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                        disabled="{!ISNULL(settingsMgr.currentSettings.selectedChildObject)}"/>
                </apex:outputPanel>

                <!--Child Object Fields-->
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field1_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Display_Field_1__c"/>
                    <apex:selectList id="Display_Field_1__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_1__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field1_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Display_Field_1__c"/>
                    <apex:inputField id="Display_Field_1__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_1__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField1_Label__c"/>
                    <apex:inputText id="ChildField1_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field1_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field1_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField1_Custom__c"/>
                    <apex:inputField id="ChildField1_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field1_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field2_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Display_Field_2__c"/>
                    <apex:selectList id="Display_Field_2__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_2__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field2_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Display_Field_2__c"/>
                    <apex:inputField id="Display_Field_2__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_2__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField2_Label__c"/>
                    <apex:inputText id="ChildField2_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field2_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field2_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField2_Custom__c"/>
                    <apex:inputField id="ChildField2_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field2_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field3_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Display_Field_3__c"/>
                    <apex:selectList id="Display_Field_3__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_3__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field3_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Display_Field_3__c"/>
                    <apex:inputField id="Display_Field_3__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_3__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField3_Label__c"/>
                    <apex:inputText id="ChildField3_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field3_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field3_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField3_Custom__c"/>
                    <apex:inputField id="ChildField3_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field3_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field4_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Display_Field_4__c"/>
                    <apex:selectList id="Display_Field_4__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_4__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field4_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Display_Field_4__c"/>
                    <apex:inputField id="Display_Field_4__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_4__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField4_Label__c"/>
                    <apex:inputText id="ChildField4_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field4_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field4_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField4_Custom__c"/>
                    <apex:inputField id="ChildField4_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field4_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field5_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Display_Field_5__c"/>
                    <apex:selectList id="Display_Field_5__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_5__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field5_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Display_Field_5__c"/>
                    <apex:inputField id="Display_Field_5__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_5__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField5_Label__c"/>
                    <apex:inputText id="ChildField5_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field5_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field5_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField5_Custom__c"/>
                    <apex:inputField id="ChildField5_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field5_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field6_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Display_Field_6__c"/>
                    <apex:selectList id="Display_Field_6__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_6__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field6_Custom__c}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Display_Field_6__c"/>
                    <apex:inputField id="Display_Field_6__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_6__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Label" for="ChildField6_Label__c"/>
                    <apex:inputText id="ChildField6_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field6_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field6_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Custom" for="ChildField6_Custom__c"/>
                    <apex:inputField id="ChildField6_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field6_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 6, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field7_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Display_Field_7__c"/>
                    <apex:selectList id="Display_Field_7__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_7__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 6, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field7_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Display_Field_7__c"/>
                    <apex:inputField id="Display_Field_7__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_7__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 6}">
                    <apex:outputLabel value="Label" for="ChildField7_Label__c"/>
                    <apex:inputText id="ChildField7_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field7_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field7_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 6}">
                    <apex:outputLabel value="Custom" for="ChildField7_Custom__c"/>
                    <apex:inputField id="ChildField7_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field7_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 7, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field8_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Display_Field_8__c"/>
                    <apex:selectList id="Display_Field_8__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_8__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 7, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field8_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Display_Field_8__c"/>
                    <apex:inputField id="Display_Field_8__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_8__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 7}">
                    <apex:outputLabel value="Label" for="ChildField8_Label__c"/>
                    <apex:inputText id="ChildField8_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field8_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field8_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 7}">
                    <apex:outputLabel value="Custom" for="ChildField8_Custom__c"/>
                    <apex:inputField id="ChildField8_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field8_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 8, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field9_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Display_Field_9__c"/>
                    <apex:selectList id="Display_Field_9__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_9__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 8, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field9_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Display_Field_9__c"/>
                    <apex:inputField id="Display_Field_9__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_9__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 8}">
                    <apex:outputLabel value="Label" for="ChildField9_Label__c"/>
                    <apex:inputText id="ChildField9_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field9_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field9_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 8}">
                    <apex:outputLabel value="Custom" for="ChildField9_Custom__c"/>
                    <apex:inputField id="ChildField9_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field9_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 9, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field10_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="Display_Field_10__c"/>
                    <apex:selectList id="Display_Field_10__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_10__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 9, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field10_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="Display_Field_10__c"/>
                    <apex:inputField id="Display_Field_10__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_10__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 9}">
                    <apex:outputLabel value="Label" for="ChildField10_Label__c"/>
                    <apex:inputText id="ChildField10_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field10_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field10_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 9}">
                    <apex:outputLabel value="Custom" for="ChildField10_Custom__c"/>
                    <apex:inputField id="ChildField10_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field10_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 10, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field11_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="Display_Field_11__c"/>
                    <apex:selectList id="Display_Field_11__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_11__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 10, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field11_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="Display_Field_11__c"/>
                    <apex:inputField id="Display_Field_11__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_11__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 10}">
                    <apex:outputLabel value="Label" for="ChildField11_Label__c"/>
                    <apex:inputText id="ChildField11_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field11_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field11_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 10}">
                    <apex:outputLabel value="Custom" for="ChildField11_Custom__c"/>
                    <apex:inputField id="ChildField11_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field11_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 11, NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field12_Custom__c))}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="Display_Field_12__c"/>
                    <apex:selectList id="Display_Field_12__c" size="1" onChange="callAction('refreshChildFieldLabels')"
                            value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_12__c}">
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                        <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(childFieldCount > 11, settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field12_Custom__c)}">
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="Display_Field_12__c"/>
                    <apex:inputField id="Display_Field_12__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Display_Field_12__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 11}">
                    <apex:outputLabel value="Label" for="ChildField12_Label__c"/>
                    <apex:inputText id="ChildField12_Label__c"
                                    disabled="{!NOT(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field12_Custom__c)}"
                                    value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field12_Label__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!childFieldCount > 11}">
                    <apex:outputLabel value="Custom" for="ChildField12_Custom__c"/>
                    <apex:inputField id="ChildField12_Custom__c"
                                     value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Field12_Custom__c}"
                                     onChange="callAction('refreshChildFieldLabels')"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:commandButton value="Add" action="{!addChildDisplayField}" reRender="childObjects"
                                        disabled="{!OR(childFieldCount >= 12, ISNULL(settingsMgr.currentSettings.currentChildObject))}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Show Records for All Users"/>
                    <apex:inputCheckbox value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Show_Records_for_All_Users__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Show Display Fields for All Users"/>
                    <apex:inputCheckbox value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Show_Display_Fields_for_All_Users__c}"/>
                </apex:pageBlockSectionItem>

            </apex:pageBlockSection>

            <!--Child Filters Section-->
            <apex:pageBlockSection collapsible="false" id="childFilters" columns="1"
                                   title="{!$Label.trachier__setup_child_filters_section}">
                <apex:variable var="childRowNum" value="{!0}"/>
                <apex:pageBlockTable value="{!settingsMgr.currentSettings.currentChildObject.filters}" var="filter">
                    <apex:column headerValue="#">{!childRowNum+1}</apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Field__c.label}">
                        <apex:inputField value="{!filter.obj.TracHier__Field__c}" rendered="{!filter.obj.TracHier__Custom__c}">
                            <apex:actionSupport event="onblur" action="{!filter.updateFilterOpts}"
                                                reRender="childFilters"/>
                        </apex:inputField>
                        <apex:selectList value="{!filter.obj.TracHier__Field__c}" size="1"
                                         rendered="{!NOT(filter.obj.TracHier__Custom__c)}">
                            <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions}"/>
                            <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions2}"/>
                            <apex:selectOptions value="{!settingsMgr.childHelper.savedChildObjectFieldSelectOptions3}"/>
                            <apex:actionSupport event="onchange" action="{!filter.updateFilterOpts}"
                                                reRender="childFilters"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Operator__c.label}">
                        <apex:selectList value="{!filter.obj.TracHier__Operator__c}" size="1">
                            <apex:selectOptions value="{!filter.filterOpts}"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Value__c.label}">
                        <apex:inputField value="{!filter.obj.TracHier__Value__c}"
                                         rendered="{!OR(NOT(filter.isDate),filter.obj.TracHier__Custom__c)}"/>
                        <apex:selectList value="{!filter.obj.TracHier__Value__c}" size="1"
                                         rendered="{!AND(filter.isDate, NOT(filter.obj.TracHier__Custom__c))}">
                            <apex:selectOptions value="{!settingsMgr.dateOpts}"/>
                        </apex:selectList>
                    </apex:column>
                    <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Custom__c.label}">
                        <apex:inputField onChange="callAction('refreshChildFilters')" value="{!filter.obj.TracHier__Custom__c}"/>
                    </apex:column>
                    <apex:column >
                        <apex:commandLink action="{!removeChildFilter}" onclick="this.onclick=function(){return false;}"
                                          reRender="childFilters">
                            Remove
                            <apex:param name="objFilterIndex" value="{!childRowNum}"/>
                        </apex:commandLink>
                        <apex:variable var="childRowNum" value="{!childRowNum + 1}"/>
                    </apex:column>
                </apex:pageBlockTable>
                <apex:commandButton value="Add" action="{!addChildFilter}" reRender="childFilters"
                                    disabled="{!ISNULL(settingsMgr.currentSettings.selectedChildObject)}"/>

                <apex:outputPanel >
                    <apex:outputLabel value="{!displayFieldMetadata.TracHier__Criteria_Logic__c.Label}"
                                      for="childCriteria_Logic__c"
                                      styleClass="labelCol vfLabelColTextWrap"
                                      style="text-align: left;"/>
                    <apex:inputText value="{!settingsMgr.currentSettings.currentChildObject.setting.TracHier__Criteria_Logic__c}"
                                    id="childCriteria_Logic__c"
                                    disabled="{!AND(ISBLANK(settingsMgr.currentSettings.currentChildObject.setting.TracHier__Criteria_Logic__c),childFilterCount<2)}"/>
                </apex:outputPanel>
            </apex:pageBlockSection>

            <!--Hierarchy Builder Settings-->
            <apex:pageBlockSection title="{!$Label.trachier__setup_linker_fields_section}" id="builderSettings"
                                   collapsible="false">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.trachier__setup_build_status_label}" for="buildStatus"
                                      title="{!$Label.trachier__setup_build_status_title}"/>
                    <apex:outputPanel layout="none" id="buildStatus">
                        <apex:outputPanel layout="none" rendered="{!batchInProgress}">
                            <apex:outputText value="{!$Label.trachier__setup_build_status_in_progress}"/>&nbsp;
                            <apex:outputPanel layout="none" rendered="{!(totalBatchItems > 0)}">
                                <progress value="{!completedBatchItems}" max="{!totalBatchItems}">
                                    - {!completedBatchItems} / {!totalBatchItems} -
                                </progress>
                                &nbsp;{!FLOOR((completedBatchItems / totalBatchItems) * 100)}%
                            </apex:outputPanel>
                        </apex:outputPanel>

                        <apex:outputPanel layout="none" rendered="{!rollupInProgress}">
                            <apex:outputText value="Calculating rollups..."/>
                        </apex:outputPanel>

                        <apex:outputPanel layout="none" rendered="{!AND(NOT(batchInProgress),NOT(rollupInProgress))}">
                            <apex:outputText value="{!$Label.trachier__setup_build_status_no_running}"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!theLinkerSettings.TracHier__Allow_null_parent_values__c}"/>
                <apex:inputField value="{!theLinkerSettings.TracHier__Populate_Native_Parent_Field__c}"
                                 rendered="{!AND(hasNativePopulation, NOT(batchInProgress))}"
                                 onChange="refreshAppendBehavior()"/>
                <apex:outputField value="{!theLinkerSettings.TracHier__Populate_Native_Parent_Field__c}"
                                  rendered="{!OR(NOT(hasNativePopulation), batchInProgress)}"/>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__Parent_Field_Append_Behavior__c.Label}"
                            title="When should data be appended to the record" for="appendBehavior"/>
                    <apex:selectList size="1" value="{!theLinkerSettings.TracHier__Parent_Field_Append_Behavior__c}"
                                     disabled="{!OR(NOT(hasNativePopulation), NOT(theLinkerSettings.TracHier__Populate_Native_Parent_Field__c))}"
                                     id="appendBehavior">
                        <apex:selectOption itemValue="always" itemLabel="Always Append"/>
                        <apex:selectOption itemValue="blank" itemLabel="Append if Blank"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__Alternative_Hierarchy_ID__c.Label}"
                            title="Use this field to stamp the Hierarchy ID if no Duns data is available"
                            for="alternativeID"/>
                    <apex:selectList size="1" value="{!theLinkerSettings.TracHier__Alternative_Hierarchy_ID__c}"
                                     id="alternativeID">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__DefaultHierarchy__c.Label}"
                            for="defaultHierarchy"/>
                    <apex:selectList value="{!theLinkerSettings.TracHier__DefaultHierarchy__c}" id="defaultHierarchy" size="1">
                        <apex:selectOptions value="{!settingsMgr.hierarchyOptions}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!theLinkerSettings.TracHier__Enable_Master_Accounts__c}" rendered="{!hasMasterAccounts}"/>
                <apex:pageBlockSectionItem rendered="{!NOT(hasMasterAccounts)}" />

                <apex:inputField value="{!theLinkerSettings.TracHier__Mass_Create_Accounts_Batch_Size__c}"
                                 rendered="{!hasDnBSearch}" />

                <apex:pageBlockSectionItem />
                <apex:inputField value="{!theLinkerSettings.TracHier__Build_Job_Batch_Size__c}"/>
            </apex:pageBlockSection>

            <div class="infoMessage">
                {!$Label.trachier__setup_linker_fields_desc}
            </div>

            <!--Rollup Settings START-->
            <apex:pageBlockSection title="Rollup Settings" id="rollupSettings"
                                   collapsible="false" rendered="{!AND(hasMasterAccounts, hasMasterAccountRollups)}">

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Scheduled Rollup Frequency" for="rollupInterval"/>
                    <apex:selectList size="1" value="{!monthsAgoToDelete}" id="deleteInterval">
                        <apex:selectOptions value="{!selectRollupSchedule}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:commandButton value="Schedule Rollups"
                                    onclick="callAction('scheduleRollups'); return false;"
                                    oncomplete="hideSpinner(); if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                    reRender="form"
                                    disabled="{!OR(NOT(theLinkerSettings.TracHier__Enable_Master_Accounts__c), ISBLANK(theLinkerSettings.TracHier__DefaultHierarchy__c))}"
                                    title="Schedule Rollups and KPIs"
                />

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Previous Months to Rollup" for="rollupInterval"/>
                    <apex:selectList size="1" value="{!monthsToRollup}" id="rollupInterval">
                        <apex:selectOptions value="{!selectRollupOptions}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:commandButton value="Rollup Previous Months"
                                    onclick="callAction('startRollup'); return false;"
                                    oncomplete="hideSpinner(); if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                    reRender="form"
                                    rendered="{!NOT(rollupInProgress)}"
                                    disabled="{!OR(batchInProgress, NOT(theLinkerSettings.TracHier__Enable_Master_Accounts__c), ISBLANK(theLinkerSettings.TracHier__DefaultHierarchy__c))}"
                                    title="Build Rollups and KPIs"
                />

                <apex:commandButton value="Cancel Rollups Job"
                                    onclick="callAction('cancelRollup'); return false;"
                                    oncomplete="hideSpinner(); if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                    reRender="messages, builderSettings, buttons, poller"
                                    rendered="{!rollupInProgress}"
                                    title="Cancel Rollups Job"/>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Historical KPIs to Delete" for="rollupInterval"/>
                    <apex:selectList size="1" value="{!monthsAgoToDelete}" id="deleteInterval">
                        <apex:selectOptions value="{!selectMonthsToDelete}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:commandButton value="Delete Historical KPIs"
                                    onclick="callAction('deleteKPIs'); return false;"
                                    oncomplete="hideSpinner(); if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                    reRender="form"
                                    disabled="{!OR(batchInProgress, rollupInProgress, NOT(theLinkerSettings.TracHier__Enable_Master_Accounts__c), ISBLANK(theLinkerSettings.TracHier__DefaultHierarchy__c))}"
                                    title="Delete Old KPIs"
                />
            </apex:pageBlockSection>

            <apex:outputPanel layout="none" rendered="{!AND(hasMasterAccounts, hasMasterAccountRollups)}">
                <div class="infoMessage">
                    Rollups and KPIs are calculated for Master Accounts.
                    KPIs summarize performance for a single month.
                </div>
            </apex:outputPanel>
            <!-- Rollup Settings END -->

            <!--Advanced Settings START (&override=x)-->
            <apex:pageBlockSection title="{!$Label.trachier__setup_advanced_section}" id="advancedSettings"
                                   collapsible="false">

                <apex:inputField value="{!theLinkerSettings.TracHier__Disable_Trigger__c}"/>
                <apex:inputField value="{!theLinkerSettings.TracHier__Enable_History_Logging__c}"/>
                <apex:inputField value="{!theLinkerSettings.TracHier__Legacy_Browser__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.trachier__setup_create_button_opens_label}"/>
                    <apex:selectList size="1" value="{!createLink}">
                        <apex:actionSupport event="onchange" reRender="advancedSettings"
                                            action="{!createLinkOptionChanged}"/>
                        <apex:selectOption itemValue="native"
                                           itemLabel="{!$Label.trachier__setup_native_new_account_page}"/>
                        <apex:selectOption itemValue="overridden"
                                           itemLabel="{!$Label.trachier__setup_overridden_new_account_page}"/>
                        <apex:selectOption itemValue="custom" itemLabel="{!$Label.trachier__setup_custom_link}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:inputField value="{!theLinkerSettings.TracHier__Custom_Create_URL__c}"
                                 rendered="{!(createLink == 'custom')}" style="min-width:200px"/>
                <apex:pageBlockSectionItem rendered="{!(createLink != 'custom')}"/>
                <apex:inputField value="{!theLinkerSettings.TracHier__Show_Create_Button_for_All_Users__c}"
                                 rendered="{!(createLink == 'custom')}"/>
                <!-- Advanced Settings END -->
            </apex:pageBlockSection>

            <!-- Multiple Hierarchy Settings START -->
            <apex:pageBlockSection title="{!$Label.trachier__custom_hierarchy_definitions}" id="hierarchiesSettings"
                                   collapsible="false">
                <!-- Custom Hierarchy Button Panel -->
                <apex:outputPanel >
                    <apex:commandButton value="{!$Label.trachier__add_hierarchy}"
                                        action="{!startAddHierarchy}"
                                        reRender="form"
                                        oncomplete="onActionComplete('page:form:hierarchySettingsModal');"
                                        />
                    <apex:selectList size="1" value="{!settingsMgr.selectedHierarchy}"
                                     onchange="callAction('savedHierarchyChanged'); return false;">
                        <apex:selectOptions value="{!settingsMgr.hierarchyOptions}"/>
                    </apex:selectList>
                    <apex:commandButton value="{!$Label.trachier__remove_hierarchy}"
                                        onclick="callAction('removeHierarchy'); return false;"
                                        oncomplete="if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                                        disabled="{!ISNULL(settingsMgr.selectedHierarchy)}"/>
                </apex:outputPanel>
                <apex:pageBlockSectionItem />

                <!-- Custom Hierarchy Fields -->
                <apex:pageBlockSectionItem rendered="{!!ISNULL(settingsMgr.selectedHierarchy)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Label__c.Label}"
                                      for="hierarchyLabel"/>
                    <apex:inputText value="{!settingsMgr.currentHierarchy.TracHier__Label__c}" id="hierarchyLabel"
                                    onblur="setHierarchyOptions()"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!!ISNULL(settingsMgr.selectedHierarchy)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Type__c.Label}"
                                      for="hierarchyType"/>

                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Type__c}" id="hierarchyType" size="1"
                                     onchange="callAction('refreshHierarchiesSettings')">
                        <apex:selectOptions value="{!settingsMgr.hierarchyTypes}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem rendered="{!!ISNULL(settingsMgr.selectedHierarchy)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Hierarchy_ID_Type__c.Label}"
                                      for="hierarchyIdType"/>

                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Hierarchy_ID_Type__c}" id="hierarchyIdType" size="1"
                                     onchange="callAction('refreshHierarchiesSettings')">
                        <apex:selectOptions value="{!settingsMgr.hierarchyIdTypes}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Identifier_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Identifier__c.Label}"
                                      for="hierarchyIdentifier"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Identifier__c}" size="1"
                                     id="hierarchyIdentifier">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Identifier_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Identifier__c.Label}"
                                      for="hierarchyIdentifier"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Identifier__c}" />
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Location_Status_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Location_Status__c.Label}"
                                      for="hierarchyLocStatus"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Location_Status__c}" size="1"
                                     id="hierarchyLocStatus">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Location_Status_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Location_Status__c.Label}"
                                      for="hierarchyLocStatus"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Location_Status__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Parent_Identifier_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Identifier__c.Label}"
                                      for="hierarchyParentIdentifier"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Parent_Identifier__c}" size="1"
                                     id="hierarchyParentIdentifier">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Parent_Identifier_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Identifier__c.Label}"
                                      for="hierarchyParentIdentifier"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Parent_Identifier__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Parent_Name_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Name__c.Label}"
                                      for="hierarchyParentName"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Parent_Name__c}" size="1"
                                     id="hierarchyParentName">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Parent_Name_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Name__c.Label}"
                                      for="hierarchyParentName"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Parent_Name__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Identifier_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Identifier__c.Label}"
                                      for="hierarchyGlobalUltIdentifier"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Identifier__c}" size="1"
                                     id="hierarchyGlobalUltIdentifier">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Identifier_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Identifier__c.Label}"
                                      for="hierarchyGlobalUltIdentifier"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Identifier__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Name_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Name__c.Label}"
                                      for="hierarchyGlobalUltName"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Name__c}" size="1"
                                     id="hierarchyGlobalUltName">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'), settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Name_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Name__c.Label}"
                                      for="hierarchyGlobalUltName"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Global_Ultimate_Name__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Domestic_Ultimate_Identifier_Custom__c == false)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Domestic_Ultimate_Identifier__c.Label}"
                                      for="hierarchyDomesticUltIdentifier"/>
                    <apex:selectList value="{!settingsMgr.currentHierarchy.TracHier__Domestic_Ultimate_Identifier__c}" size="1"
                                     id="hierarchyDomesticUltIdentifier">
                        <apex:selectOptions value="{!accountFields}"/>
                        <apex:selectOptions value="{!accountFields2}"/>
                        <apex:selectOptions value="{!accountFields3}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom', settingsMgr.currentHierarchy.TracHier__Domestic_Ultimate_Identifier_Custom__c == true)}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Domestic_Ultimate_Identifier__c.Label}"
                                      for="hierarchyDomesticUltIdentifier"/>
                    <apex:outputField value="{!settingsMgr.currentHierarchy.TracHier__Domestic_Ultimate_Identifier__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),OR(settingsMgr.currentHierarchy.TracHier__Type__c == 'Custom',settingsMgr.currentHierarchy.TracHier__Type__c == 'List'))}">
                    <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Case_Sensitive__c.Label}"
                                      for="caseSensitive"/>
                    <apex:inputField value="{!settingsMgr.currentHierarchy.TracHier__Case_Sensitive__c}" id="caseSensitive" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:outputPanel id="hierarchiesSettings_Customer360"
                              rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Customer360')}">
                <div class="infoMessage">
                    Hierarchy will use fields from Salesforce Customer 360 to determine account relationships.
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="hierarchiesSettings_DataDotCom"
                              rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Data.com')}">
                <div class="infoMessage">
                    Hierarchy will use fields from Data.com to determine account relationships.
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="hierarchiesSettings_Optimizer"
                              rendered="{!AND(NOT(ISBLANK(settingsMgr.selectedHierarchy)),settingsMgr.currentHierarchy.TracHier__Type__c == 'Optimizer')}">
                <div class="infoMessage">
                    Hierarchy will use fields from Optimizer to determine account relationships.
                </div>
            </apex:outputPanel>
            <!-- Multiple Hierarchy Settings END -->

            <!--D&B Direct+ API Settings Section-->
            <apex:pageBlockSection title="Advanced Whitespace Settings" id="dnbSettings"
                                   collapsible="false" rendered="{!showAdvancedWhitespace}">
                <apex:inputField value="{!theLinkerSettings.TracHier__Enable_DnB__c}"/>
                <apex:pageBlockSectionItem />
                <apex:inputField value="{!theLinkerSettings.TracHier__DnB_Key__c}"/>
                <apex:inputSecret value="{!theLinkerSettings.TracHier__DnB_Secret__c}" redisplay="true"/>
            </apex:pageBlockSection>
        </apex:pageBlock>


        <!--Add profile modal > action:addNewProfile > modal_id: page:form:addBlock  -->
        <apex:outputPanel layout="block" styleclass="addModalBackground" rendered="{!settingsMgr.addInProgress}">
            <apex:outputPanel layout="block" styleclass="addModal" rendered="{!settingsMgr.addInProgress}">
                <apex:pageBlock title="{!$Label.trachier__setup_add_new_per_profile_settings_title}" id="addBlock">
                    <apex:pageBlockButtons location="top">
                        <apex:commandButton value="{!$Label.trachier__setup_add_modal_add_button}"
                                            action="{!addProfile}" reRender="form"/>
                        <apex:commandButton value="{!$Label.trachier__setup_add_modal_cancel_button}"
                                            action="{!settingsMgr.cancel}" reRender="form"/>
                    </apex:pageBlockButtons>
                    <apex:pageBlockSection collapsible="false" id="displayfields_add" columns="3">
                        <apex:facet name="header">
                            <apex:outputPanel >
                                <h3>
                                    {!$Label.trachier__setup_display_fields_section} - Profile:&nbsp;
                                    <apex:selectList size="1" id="addProfile"
                                                     value="{!settingsMgr.selectedProfileName}">
                                        <apex:selectOptions value="{!settingsMgr.profilePicklist}"/>
                                    </apex:selectList>
                                </h3>
                            </apex:outputPanel>
                        </apex:facet>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field1_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Field1__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field1__c}" id="Field1__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field1_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="InputField1__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field1__c}" id="InputField1__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field1_Label__c"/>
                            <apex:inputText id="Field1_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field1_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field1_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field1_Custom__c"/>
                            <apex:inputField id="Field1_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field1_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field2_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Field2__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field2__c}" id="Field2__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field2_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="InputField2__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field2__c}" id="InputField2__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field2_Label__c"/>
                            <apex:inputText id="Field2_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field2_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field2_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field2_Custom__c"/>
                            <apex:inputField id="Field2_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field2_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field3_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Field3__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field3__c}" id="Field3__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field3_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="InputField3__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field3__c}" id="InputField3__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field3_Label__c"/>
                            <apex:inputText id="Field3_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field3_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field3_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field3_Custom__c"/>
                            <apex:inputField id="Field3_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field3_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field4_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Field4__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field4__c}" id="Field4__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field4_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="InputField4__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field4__c}" id="InputField4__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field4_Label__c"/>
                            <apex:inputText id="Field4_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field4_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field4_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field4_Custom__c"/>
                            <apex:inputField id="Field4_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field4_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field5_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Field5__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field5__c}" id="Field5__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field5_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="InputField5__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field5__c}" id="InputField5__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field5_Label__c"/>
                            <apex:inputText id="Field5_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field5_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field5_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field5_Custom__c"/>
                            <apex:inputField id="Field5_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field5_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.newSettings.fields.TracHier__Field6_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Field6__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field6__c}" id="Field6__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.fields.TracHier__Field6_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="InputField6__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field6__c}" id="InputField6__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="Field6_Label__c"/>
                            <apex:inputText id="Field6_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field6_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field6_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="Field6_Custom__c"/>
                            <apex:inputField id="Field6_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field6_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 7, NOT(settingsMgr.newSettings.fields.TracHier__Field7_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Field7__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field7__c}" id="Field7__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 7, settingsMgr.newSettings.fields.TracHier__Field7_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="InputField7__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field7__c}" id="InputField7__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 7}">
                            <apex:outputLabel value="Label" for="Field7_Label__c"/>
                            <apex:inputText id="Field7_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field7_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field7_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 7}">
                            <apex:outputLabel value="Custom" for="Field7_Custom__c"/>
                            <apex:inputField id="Field7_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field7_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 8, NOT(settingsMgr.newSettings.fields.TracHier__Field8_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Field8__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field8__c}" id="Field8__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 8, settingsMgr.newSettings.fields.TracHier__Field8_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="InputField8__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field8__c}" id="InputField8__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 8}">
                            <apex:outputLabel value="Label" for="Field8_Label__c"/>
                            <apex:inputText id="Field8_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field8_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field8_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 8}">
                            <apex:outputLabel value="Custom" for="Field8_Custom__c"/>
                            <apex:inputField id="Field8_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field8_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 9, NOT(settingsMgr.newSettings.fields.TracHier__Field9_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Field9__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field9__c}" id="Field9__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 9, settingsMgr.newSettings.fields.TracHier__Field9_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="InputField9__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field9__c}" id="InputField9__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 9}">
                            <apex:outputLabel value="Label" for="Field9_Label__c"/>
                            <apex:inputText id="Field9_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field9_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field9_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 9}">
                            <apex:outputLabel value="Custom" for="Field9_Custom__c"/>
                            <apex:inputField id="Field9_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field9_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 10, NOT(settingsMgr.newSettings.fields.TracHier__Field10_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="Field10__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field10__c}" id="Field10__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 10, settingsMgr.newSettings.fields.TracHier__Field10_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="InputField10__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field10__c}" id="InputField10__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 10}">
                            <apex:outputLabel value="Label" for="Field10_Label__c"/>
                            <apex:inputText id="Field10_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field10_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field10_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 10}">
                            <apex:outputLabel value="Custom" for="Field10_Custom__c"/>
                            <apex:inputField id="Field10_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field10_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 11, NOT(settingsMgr.newSettings.fields.TracHier__Field11_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="Field11__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field11__c}" id="Field11__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 11, settingsMgr.newSettings.fields.TracHier__Field11_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="InputField11__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field11__c}" id="InputField11__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 11}">
                            <apex:outputLabel value="Label" for="Field11_Label__c"/>
                            <apex:inputText id="Field11_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field11_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field11_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 11}">
                            <apex:outputLabel value="Custom" for="Field11_Custom__c"/>
                            <apex:inputField id="Field11_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field11_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 12, NOT(settingsMgr.newSettings.fields.TracHier__Field12_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="Field12__c"/>
                            <apex:selectList value="{!settingsMgr.newSettings.fields.TracHier__Field12__c}" id="Field12__c" size="1" onChange="callAction('refreshNewFieldLabels')">
                                <apex:selectOptions value="{!accountFields}"/>
                                <apex:selectOptions value="{!accountFields2}"/>
                                <apex:selectOptions value="{!accountFields3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(settingsMgr.newSettings.displayFieldCount >= 12, settingsMgr.newSettings.fields.TracHier__Field12_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="InputField12__c"/>
                            <apex:inputField value="{!settingsMgr.newSettings.fields.TracHier__Field12__c}" id="InputField12__c"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 12}">
                            <apex:outputLabel value="Label" for="Field12_Label__c"/>
                            <apex:inputText id="Field12_Label__c" value="{!settingsMgr.newSettings.fields.TracHier__Field12_Label__c}"
                                            disabled="{!NOT(settingsMgr.newSettings.fields.TracHier__Field12_Custom__c)}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.displayFieldCount >= 12}">
                            <apex:outputLabel value="Custom" for="Field12_Custom__c"/>
                            <apex:inputField id="Field12_Custom__c"
                                             value="{!settingsMgr.newSettings.fields.TracHier__Field12_Custom__c}"
                                             onChange="callAction('refreshNewFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:commandButton value="Add" action="{!settingsMgr.newSettings.addDisplayField}"
                                            reRender="displayfields_add"
                                            disabled="{!settingsMgr.newSettings.displayFieldCount >= 12}"/>
                    </apex:pageBlockSection>

                    <!--Display Fields Section-->
                    <apex:pageBlockSection collapsible="false" id="hierarchysettings_add"
                                           title="{!$Label.trachier__setup_display_settings_section}">

                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Show_Records_for_All_Users__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Disable_Per_User_Field_Selection__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Show_Display_Fields_for_All_Users__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Disable_Duplicate_Check__c}"
                                            onchange="callAction('disableDuplicateCheckChanged')"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Create_Inferred_Account_Button__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Click_to_Merge__c}"
                                            rendered="{!NOT(settingsMgr.newSettings.settings.TracHier__Disable_Duplicate_Check__c)}"/>

                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_CSV_Download__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Inline_Editing__c}"/>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.newSettings.settings.TracHier__Disable_Duplicate_Check__c}">
                        <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy_Settings__c.fields.TracHier__Enable_Click_to_Merge__c.label}"
                                            style="color: #909090"/>
                        <apex:inputCheckbox disabled="true"/>
                        </apex:pageBlockSectionItem>

                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Show_Summary_Footer__c}"/>
                        <apex:pageBlockSectionItem />

                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Field_Filters__c}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Display_Child_Objects__c}"/>

                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Whitespace_Prospecting__c}"
                                            rendered="{!hasDnBSearch}"
                                            onChange="callAction('refreshWhitespaceSettingsAdd')"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Enable_Mass_Create_Accounts__c}"
                                            rendered="{!hasDnBSearch}"/>
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Show_Overridden_Accounts_in_Whitespace__c}"
                                            rendered="{!AND(hasDnBSearch, settingsMgr.newSettings.settings.TracHier__Enable_Whitespace_Prospecting__c)}" />
                        <apex:pageBlockSectionItem rendered="{!AND(hasDnBSearch, NOT(settingsMgr.newSettings.settings.TracHier__Enable_Whitespace_Prospecting__c))}" />
                        <apex:inputField value="{!settingsMgr.newSettings.settings.TracHier__Mass_Create_Accounts_Batch_Size__c}"
                                            rendered="{!hasDnBSearch}" />
                    </apex:pageBlockSection>

                    <!--Hierarchy Modal Filters Section-->
                    <apex:pageBlockSection collapsible="false" id="hierarchyFiltersModal" columns="1"
                                           title="{!$Label.trachier__setup_filters_section}">

                        <apex:variable var="modalRowNum" value="{!0}"/>
                        <apex:pageBlockTable value="{!settingsMgr.newSettings.filters}" var="filter">
                            <apex:column headerValue="#">{!modalRowNum+1}</apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Field__c.label}">
                                <apex:inputField value="{!filter.obj.TracHier__Field__c}" rendered="{!filter.obj.TracHier__Custom__c}">
                                    <apex:actionSupport event="onblur" action="{!filter.updateFilterOpts}"
                                                        reRender="hierarchyFiltersModal"/>
                                </apex:inputField>
                                <apex:selectList value="{!filter.obj.TracHier__Field__c}" size="1"
                                                 rendered="{!NOT(filter.obj.TracHier__Custom__c)}">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                    <apex:actionSupport event="onchange" action="{!filter.updateFilterOpts}"
                                                        reRender="hierarchyFiltersModal"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Operator__c.label}">
                                <apex:selectList value="{!filter.obj.TracHier__Operator__c}" size="1">
                                    <apex:selectOptions value="{!filter.filterOpts}"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Value__c.label}">
                                <apex:inputField value="{!filter.obj.TracHier__Value__c}"
                                                 rendered="{!OR(NOT(filter.isDate),filter.obj.TracHier__Custom__c)}"/>
                                <apex:selectList value="{!filter.obj.TracHier__Value__c}" size="1"
                                                 rendered="{!AND(filter.isDate, NOT(filter.obj.TracHier__Custom__c))}">
                                    <apex:selectOptions value="{!settingsMgr.dateOpts}"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Custom__c.label}">
                                <apex:inputField onChange="callAction('refreshModalFilters')" value="{!filter.obj.TracHier__Custom__c}"/>
                            </apex:column>
                            <apex:column >
                                <apex:commandLink action="{!removeFilterModal}"
                                                  onclick="this.onclick=function(){return false;}"
                                                  reRender="hierarchyFiltersModal">
                                    Remove
                                    <apex:param name="objFilterIndex" value="{!modalRowNum}"/>
                                </apex:commandLink>
                                <apex:variable var="modalRowNum" value="{!modalRowNum + 1}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                        <apex:commandButton value="Add" action="{!addFilterModal}" reRender="hierarchyFiltersModal"/>

                        <apex:outputPanel >
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Criteria_Logic__c.Label}"
                                              for="modalCriteria_Logic__c"
                                              styleClass="labelCol vfLabelColTextWrap"
                                              style="text-align: left;"/>
                            <apex:inputText value="{!settingsMgr.newSettings.fields.TracHier__Criteria_Logic__c}"
                                            id="modalCriteria_Logic__c"
                                            disabled="{!AND(ISBLANK(settingsMgr.newSettings.fields.TracHier__Criteria_Logic__c),filterCountModal<2)}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>


        <!--START child object modal > action:startAddChildObject > modal_id: page:form:addChildObjectBlock -->
        <apex:outputPanel layout="block" styleclass="addModalBackground"
                          rendered="{!settingsMgr.currentSettings.addInProgress}">
            <apex:outputPanel layout="block" styleclass="addModal"
                              rendered="{!settingsMgr.currentSettings.addInProgress}">
                <apex:pageBlock title="{!$Label.trachier__add_child_object_header}" id="addChildObjectBlock" >
                    <apex:pageBlockButtons location="top">
                        <apex:commandButton value="{!$Label.trachier__setup_add_modal_add_button}"
                                            action="{!addChildObjectToCustomSettings}" reRender="form"
                                            oncomplete="if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"
                        />
                        <apex:commandButton value="{!$Label.trachier__setup_add_modal_cancel_button}"
                                            action="{!cancelAddChildObject}" reRender="form"/>
                    </apex:pageBlockButtons>
                    <apex:pageBlockSection collapsible="false" id="childObjectFieldsSection" columns="3">
                        <apex:facet name="header">
                            <apex:outputPanel >
                                <h3>
                                    {!$Label.trachier__Child_Object_Label}&nbsp;
                                    <apex:selectList size="1" id="addProfile"
                                                     value="{!settingsMgr.currentSettings.selectedNewChildObject}"
                                                     onChange="callAction('modalChildObjectChanged')">
                                        <apex:selectOptions value="{!settingsMgr.childHelper.childObjectList}"/>
                                    </apex:selectList>
                                </h3>
                            </apex:outputPanel>
                        </apex:facet>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field1_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Display_Field_1__c"/>
                            <apex:selectList id="Display_Field_1__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_1__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field1_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field1__c.Label}" for="Display_Field_1__c"/>
                            <apex:inputField id="Display_Field_1__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_1__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField1_Label__c"/>
                            <apex:inputText id="ChildField1_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field1_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field1_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField1_Custom__c"/>
                            <apex:inputField id="ChildField1_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field1_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field2_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Display_Field_2__c"/>
                            <apex:selectList id="Display_Field_2__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_2__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field2_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field2__c.Label}" for="Display_Field_2__c"/>
                            <apex:inputField id="Display_Field_2__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_2__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField2_Label__c"/>
                            <apex:inputText id="ChildField2_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field2_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field2_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField2_Custom__c"/>
                            <apex:inputField id="ChildField2_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field2_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field3_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Display_Field_3__c"/>
                            <apex:selectList id="Display_Field_3__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_3__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field3_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field3__c.Label}" for="Display_Field_3__c"/>
                            <apex:inputField id="Display_Field_3__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_3__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField3_Label__c"/>
                            <apex:inputText id="ChildField3_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field3_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field3_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField3_Custom__c"/>
                            <apex:inputField id="ChildField3_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field3_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field4_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Display_Field_4__c"/>
                            <apex:selectList id="Display_Field_4__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_4__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field4_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field4__c.Label}" for="Display_Field_4__c"/>
                            <apex:inputField id="Display_Field_4__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_4__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField4_Label__c"/>
                            <apex:inputText id="ChildField4_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field4_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field4_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField4_Custom__c"/>
                            <apex:inputField id="ChildField4_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field4_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field5_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Display_Field_5__c"/>
                            <apex:selectList id="Display_Field_5__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_5__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field5_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field5__c.Label}" for="Display_Field_5__c"/>
                            <apex:inputField id="Display_Field_5__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_5__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField5_Label__c"/>
                            <apex:inputText id="ChildField5_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field5_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field5_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField5_Custom__c"/>
                            <apex:inputField id="ChildField5_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field5_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field6_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Display_Field_6__c"/>
                            <apex:selectList id="Display_Field_6__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_6__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field6_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field6__c.Label}" for="Display_Field_6__c"/>
                            <apex:inputField id="Display_Field_6__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_6__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Label" for="ChildField6_Label__c"/>
                            <apex:inputText id="ChildField6_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field6_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field6_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Custom" for="ChildField6_Custom__c"/>
                            <apex:inputField id="ChildField6_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field6_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 6, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field7_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Display_Field_7__c"/>
                            <apex:selectList id="Display_Field_7__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_7__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 6, settingsMgr.currentSettings.newChildObject.setting.TracHier__Field7_Custom__c)}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field7__c.Label}" for="Display_Field_7__c"/>
                            <apex:inputField id="Display_Field_7__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_7__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 6}">
                            <apex:outputLabel value="Label" for="ChildField7_Label__c"/>
                            <apex:inputText id="ChildField7_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field7_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field7_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 6}">
                            <apex:outputLabel value="Custom" for="ChildField7_Custom__c"/>
                            <apex:inputField id="ChildField7_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field7_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 7, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field8_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Display_Field_8__c"/>
                            <apex:selectList id="Display_Field_8__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_8__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field8_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field8__c.Label}" for="Display_Field_8__c"/>
                            <apex:inputField id="Display_Field_8__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_8__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 7}">
                            <apex:outputLabel value="Label" for="ChildField8_Label__c"/>
                            <apex:inputText id="ChildField8_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field8_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field8_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 7}">
                            <apex:outputLabel value="Custom" for="ChildField8_Custom__c"/>
                            <apex:inputField id="ChildField8_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field8_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 8, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field9_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Display_Field_9__c"/>
                            <apex:selectList id="Display_Field_9__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_9__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field9_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field9__c.Label}" for="Display_Field_9__c"/>
                            <apex:inputField id="Display_Field_9__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_9__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 8}">
                            <apex:outputLabel value="Label" for="ChildField9_Label__c"/>
                            <apex:inputText id="ChildField9_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field9_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field9_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 8}">
                            <apex:outputLabel value="Custom" for="ChildField9_Custom__c"/>
                            <apex:inputField id="ChildField9_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field9_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 9, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field10_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}"
                                              for="Display_Field_10__c"/>
                            <apex:selectList id="Display_Field_10__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_10__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field10_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field10__c.Label}" for="Display_Field_10__c"/>
                            <apex:inputField id="Display_Field_10__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_10__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 9}">
                            <apex:outputLabel value="Label" for="ChildField10_Label__c"/>
                            <apex:inputText id="ChildField10_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field10_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field10_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 9}">
                            <apex:outputLabel value="Custom" for="ChildField10_Custom__c"/>
                            <apex:inputField id="ChildField10_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field10_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 10, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field11_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}"
                                              for="Display_Field_11__c"/>
                            <apex:selectList id="Display_Field_11__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_11__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field11_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field11__c.Label}" for="Display_Field_11__c"/>
                            <apex:inputField id="Display_Field_11__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_11__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 10}">
                            <apex:outputLabel value="Label" for="ChildField11_Label__c"/>
                            <apex:inputText id="ChildField11_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field11_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field11_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 10}">
                            <apex:outputLabel value="Custom" for="ChildField11_Custom__c"/>
                            <apex:inputField id="ChildField11_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field11_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!AND(childFieldCountModal > 11, NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field12_Custom__c))}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}"
                                              for="Display_Field_12__c"/>
                            <apex:selectList id="Display_Field_12__c" size="1" onChange="callAction('refreshNewChildFieldLabels')"
                                    value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_12__c}">
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions2}"/>
                                <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions3}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field12_Custom__c}">
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Field12__c.Label}" for="Display_Field_12__c"/>
                            <apex:inputField id="Display_Field_12__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Display_Field_12__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 11}">
                            <apex:outputLabel value="Label" for="ChildField12_Label__c"/>
                            <apex:inputText id="ChildField12_Label__c"
                                            disabled="{!NOT(settingsMgr.currentSettings.newChildObject.setting.TracHier__Field12_Custom__c)}"
                                            value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field12_Label__c}"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem rendered="{!childFieldCountModal > 11}">
                            <apex:outputLabel value="Custom" for="ChildField12_Custom__c"/>
                            <apex:inputField id="ChildField12_Custom__c"
                                             value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Field12_Custom__c}"
                                             onChange="callAction('refreshNewChildFieldLabels')"/>
                        </apex:pageBlockSectionItem>

                        <apex:pageBlockSectionItem >
                            <apex:commandButton value="Add"
                                                action="{!settingsMgr.currentSettings.newChildObject.addDisplayField}"
                                                reRender="addChildObjectBlock"
                                                disabled="{!childFieldCountModal >= 12}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem />
                        <apex:pageBlockSectionItem />

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Show Records for All Users"/>
                            <apex:inputCheckbox value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Show_Records_for_All_Users__c}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Show Display Fields for All Users"/>
                            <apex:inputCheckbox value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Show_Display_Fields_for_All_Users__c}"/>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>


                    <!--Child Filters Section-->
                    <apex:pageBlockSection collapsible="false" id="childFiltersModal" columns="1"
                                           title="{!$Label.trachier__setup_child_filters_section}">

                        <apex:variable var="modalChildRowNum" value="{!0}"/>
                        <apex:pageBlockTable value="{!settingsMgr.currentSettings.newChildObject.filters}" var="filter">
                            <apex:column headerValue="#">{!modalChildRowNum+1}</apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Field__c.label}">
                                <apex:inputField value="{!filter.obj.TracHier__Field__c}" rendered="{!filter.obj.TracHier__Custom__c}">
                                    <apex:actionSupport event="onblur" action="{!filter.updateFilterOpts}"
                                                        reRender="childFiltersModal"/>
                                </apex:inputField>
                                <apex:selectList value="{!filter.obj.TracHier__Field__c}" size="1"
                                                 rendered="{!NOT(filter.obj.TracHier__Custom__c)}">
                                    <apex:selectOptions value="{!settingsMgr.childHelper.modalChildObjectFieldSelectOptions}"/>
                                    <apex:actionSupport event="onchange" action="{!filter.updateFilterOpts}"
                                                        reRender="childFiltersModal"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Operator__c.label}">
                                <apex:selectList value="{!filter.obj.TracHier__Operator__c}" size="1">
                                    <apex:selectOptions value="{!filter.filterOpts}"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Value__c.label}">
                                <apex:inputField value="{!filter.obj.TracHier__Value__c}"
                                                 rendered="{!OR(NOT(filter.isDate),filter.obj.TracHier__Custom__c)}"/>
                                <apex:selectList value="{!filter.obj.TracHier__Value__c}" size="1"
                                                 rendered="{!AND(filter.isDate, NOT(filter.obj.TracHier__Custom__c))}">
                                    <apex:selectOptions value="{!settingsMgr.dateOpts}"/>
                                </apex:selectList>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TracHier__Filter__c.fields.TracHier__Custom__c.label}">
                                <apex:inputField onChange="callAction('refreshModalChildFilters')" value="{!filter.obj.TracHier__Custom__c}"/>
                            </apex:column>
                            <apex:column >
                                <apex:commandLink action="{!removeChildFilterModal}"
                                                  onclick="this.onclick=function(){return false;}"
                                                  reRender="childFiltersModal">
                                    Remove
                                    <apex:param name="objFilterIndex" value="{!modalChildRowNum}"/>
                                </apex:commandLink>
                                <apex:variable var="modalChildRowNum" value="{!modalChildRowNum + 1}"/>
                            </apex:column>
                        </apex:pageBlockTable>
                        <apex:commandButton value="Add" action="{!addChildFilterModal}" reRender="childFiltersModal"/>

                        <apex:outputPanel >
                            <apex:outputLabel value="{!displayFieldMetadata.TracHier__Criteria_Logic__c.Label}"
                                              for="modalChildCriteria_Logic__c"
                                              styleClass="labelCol vfLabelColTextWrap"
                                              style="text-align: left;"/>
                            <apex:inputText value="{!settingsMgr.currentSettings.newChildObject.setting.TracHier__Criteria_Logic__c}"
                                    id="modalChildCriteria_Logic__c"
                                    disabled="{!AND(ISBLANK(settingsMgr.currentSettings.newChildObject.setting.TracHier__Criteria_Logic__c),childFilterCountModal<2)}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        <!--END child object modal-->

        <!-- START Hierarchy Override modal  > modal_id: page:form:hierarchySettingsModal -->
        <apex:outputPanel layout="block" styleclass="addModalBackground"
                          rendered="{!settingsMgr.addHierarchyInProgress}">
            <apex:outputPanel layout="block" styleclass="addModal" style="margin-top:800px;"
                              rendered="{!settingsMgr.addHierarchyInProgress}">
                <apex:pageBlock title="{!$Label.trachier__add_new_custom_hierarchy}" id="hierarchySettingsModal" >

                        <apex:pageMessages id="hierarchySettingsModalMessages" escape="false"
                                           rendered="{!settingsMgr.addHierarchyInProgress}"/>

                        <apex:pageBlockButtons location="top">
                            <apex:commandButton value="{!$Label.trachier__setup_add_modal_add_button}"
                                                action="{!addHierarchyToCustomSettings}"
                                                reRender="form, hierarchiesSettings"
                                                oncomplete="if(!{!hasErrorsOrWarnings}) setTimeout(refreshMessages, 1000);"/>
                            <apex:commandButton value="{!$Label.trachier__setup_add_modal_cancel_button}"
                                                action="{!cancelAddHierarchy}" reRender="form"/>
                        </apex:pageBlockButtons>
                        <apex:pageBlockSection collapsible="false" id="hierarchyFieldsSection">

                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Label__c.Label}"
                                                  for="hierarchyLabel"/>
                                <apex:inputText value="{!settingsMgr.newHierarchy.TracHier__Label__c}" id="hierarchyLabel"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Type__c.Label}"
                                                  for="hierarchyType"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Type__c}" id="hierarchyType" size="1"
                                                 onchange="callAction('refreshHierarchiesSettings')">
                                    <apex:selectOptions value="{!settingsMgr.hierarchyTypes}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem />
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Hierarchy_ID_Type__c.Label}"
                                                  for="hierarchyIdType"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Hierarchy_ID_Type__c}" id="hierarchyIdType" size="1"
                                                 onchange="callAction('refreshHierarchiesSettings')">
                                    <apex:selectOptions value="{!settingsMgr.hierarchyIdTypes}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem rendered="{!OR(settingsMgr.newHierarchy.TracHier__Type__c == 'Custom', settingsMgr.newHierarchy.TracHier__Type__c == 'List')}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Identifier__c.Label}"
                                                  for="hierarchyIdentifier"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Identifier__c}" size="1"
                                                 id="hierarchyIdentifier">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!OR(settingsMgr.newHierarchy.TracHier__Type__c == 'Custom', settingsMgr.newHierarchy.TracHier__Type__c == 'List')}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Location_Status__c.Label}"
                                                  for="hierarchyLocStatus"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Location_Status__c}" size="1"
                                                 id="hierarchyLocStatus">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Custom'}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Identifier__c.Label}"
                                                  for="hierarchyParentIdentifier"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Parent_Identifier__c}" size="1"
                                                 id="hierarchyParentIdentifier">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Custom'}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Parent_Name__c.Label}"
                                                  for="hierarchyParentName"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Parent_Name__c}" size="1"
                                                 id="hierarchyParentName">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!OR(settingsMgr.newHierarchy.TracHier__Type__c == 'Custom', settingsMgr.newHierarchy.TracHier__Type__c == 'List')}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Identifier__c.Label}"
                                        for="hierarchyGlobalUltIdentifier"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Global_Ultimate_Identifier__c}" size="1"
                                                 id="hierarchyGlobalUltIdentifier">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!OR(settingsMgr.newHierarchy.TracHier__Type__c == 'Custom', settingsMgr.newHierarchy.TracHier__Type__c == 'List')}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Global_Ultimate_Name__c.Label}"
                                                  for="hierarchyGlobalUltName"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Global_Ultimate_Name__c}" size="1"
                                                 id="hierarchyGlobalUltName">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Custom'}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Domestic_Ultimate_Identifier__c.Label}"
                                        for="hierarchyDomesticUltIdentifier"/>
                                <apex:selectList value="{!settingsMgr.newHierarchy.TracHier__Domestic_Ultimate_Identifier__c}"
                                                 size="1"
                                                 id="hierarchyDomesticUltIdentifier">
                                    <apex:selectOptions value="{!accountFields}"/>
                                    <apex:selectOptions value="{!accountFields2}"/>
                                    <apex:selectOptions value="{!accountFields3}"/>
                                </apex:selectList>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem rendered="{!OR(settingsMgr.newHierarchy.TracHier__Type__c == 'Custom', settingsMgr.newHierarchy.TracHier__Type__c == 'List')}">
                                <apex:outputLabel value="{!$ObjectType.TracHier__Hierarchy__c.fields.TracHier__Case_Sensitive__c.Label}"
                                                  for="caseSensitive"/>
                                <apex:inputField value="{!settingsMgr.newHierarchy.TracHier__Case_Sensitive__c}" id="caseSensitive" />
                            </apex:pageBlockSectionItem>
                        </apex:pageBlockSection>

                        <apex:outputPanel id="hierarchiesSettingsModal_Customer360"
                                          rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Customer360'}">
                            <div class="infoMessage">
                                Hierarchy will use fields from Salesforce Customer 360 to determine account relationships.
                            </div>
                        </apex:outputPanel>

                        <apex:outputPanel id="hierarchiesSettingsModal_DataDotCom"
                                          rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Data.com'}">
                            <div class="infoMessage">
                                Hierarchy will use fields from Data.com to determine account relationships.
                            </div>
                        </apex:outputPanel>

                        <apex:outputPanel id="hierarchiesSettingsModal_Optimizer"
                                      rendered="{!settingsMgr.newHierarchy.TracHier__Type__c == 'Optimizer'}">
                        <div class="infoMessage">
                            Hierarchy will use fields from Optimizer to determine account relationships.
                        </div>
                    </apex:outputPanel>

                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        <!-- END Hierarchy Override modal -->

        <!-- START Build Hierarchy modal > modal_id: buildHierarchyModal -->
        <apex:outputPanel layout="block" styleclass="addModalBackground" rendered="{!configuringBatch}">
            <apex:outputPanel layout="block" styleclass="addModal" rendered="{!configuringBatch}">
                <apex:pageBlock title="{!$Label.trachier__setup_start_batch_button}" id="buildHierarchyModal">

                    <apex:pageMessages id="buildHierarchyModalMessages" escape="false" rendered="{!configuringBatch}"/>

                    <apex:pageBlockButtons location="top">
                        <apex:commandButton value="{!$Label.trachier__setup_start_batch_button}" action="{!startBatch}"
                                            reRender="form"
                                            rendered="{!NOT(batchInProgress)}"
                                            disabled="{!ISBLANK(theLinkerSettings.TracHier__DefaultHierarchy__c)}"
                                            title="{!$Label.trachier__setup_start_batch_button_title}"/>
                        <apex:commandButton value="{!$Label.trachier__setup_add_modal_cancel_button}"
                                            action="{!cancelConfigureBatch}" reRender="form"/>
                    </apex:pageBlockButtons>

                    <apex:pageBlockSection collapsible="false" id="buildHierarchyOptions">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Select accounts to build"
                                              for="accountsToBuild"/>
                            <apex:selectList value="{!selectedBatchFilter}" id="accountsToBuild" size="1">
                                <apex:selectOptions value="{!selectedBatchOptions}"/>
                            </apex:selectList>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        <!-- END Build Hierarchy modal -->
    </apex:form>
</apex:page>